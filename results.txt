Selected features for each outcome variable:
OS: ['age', 'biopsy_preTreat', 'tumor_size_cm_preTrt_preSurgery', 'nuclear_grade_preTrt', 'ERbb2_preTrt', 'Erbeta_preTrt', 'carboplatin', 'Race', 'RCB', 'menopausal_status']
DFS: ['chemotherapy', 'hormone_therapy', 'pCR_postTrt_days', 'topoihc_preTrt', 'metastasis_months', 'died_from_cancer_if_dead', 'ERBB2_CPN_amplified', 'tumor_size_cm_postTrt_1', 'pCR_spectrum', 'estrogen_receptor']
RFS: ['hormone_therapy', 'pCR_postTrt_days', 'metastasis_months', 'tumor_size_cm_postTrt', 'ESR1_preTrt', 'cytokeratin5_pos', 'epirubicin', 'tumor_stage_postTrt', 'pCR_spectrum', 'therapy']

Training for all decisions completed.
Feature importance for surgery:
[('preTrt_totalLymphNodes', 0.55), ('PR_percentage_preTrt', 0.45)]
Feature importance for chemotherapy:
[('postTrt_numPosLymphNodes', 0.5), ('topoihc_preTrt', 0.5)]
Feature importance for hormone_therapy:
[('pCR_postTrt_days', 0.56), ('metastasis_months', 0.44)]
Feature importance for radiotherapy:
[('metastasis_months_2', 0.24), ('preTrt_numPosLymphNodes', 0.23), ('PR_fmolmg_preTrt', 0.2), ('ER_fmolmg_preTrt', 0.19), ('age', 0.14)]
Building and evaluating Treatment Simulator model for OS.
Loaded trained Treatment Simulator model for OS
Fitting 5 folds for each of 144 candidates, totalling 720 fits

Best hyperparameters for OS:
{'C': 0.1, 'class_weight': 'balanced', 'degree': 2, 'gamma': 'scale', 'kernel': 'poly'}
Evaluating Treatment Simulator model for OS
Outcome: OS
Mean Accuracy: 0.4156
95% Confidence Interval: [0.3935, 0.4380]
Treatment Simulator evaluation completed for OS.
Building and evaluating Treatment Simulator model for DFS.
Loaded trained Treatment Simulator model for DFS

Best hyperparameters for DFS:
{'C': 0.1, 'class_weight': 'balanced', 'degree': 2, 'gamma': 'scale', 'kernel': 'poly'}
Evaluating Treatment Simulator model for DFS
Outcome: DFS
Mean Accuracy: 0.3654
95% Confidence Interval: [0.3445, 0.3870]
Treatment Simulator evaluation completed for DFS.

Best hyperparameters for RFS:
{'C': 0.1, 'class_weight': 'balanced', 'degree': 2, 'gamma': 'scale', 'kernel': 'poly'}
Evaluating Treatment Simulator model for RFS
Outcome: RFS
Mean Accuracy: 0.4118
95% Confidence Interval: [0.3885, 0.4330]
Treatment Simulator evaluation completed for RFS.


Evaluating DQL model for surgery
Evaluation metrics for surgery:
Accuracy: 0.6060
Precision: 0.6060
Recall: 0.6060
F1-score: 0.6060
Evaluating DQL model for chemotherapy
Evaluation metrics for chemotherapy:
Accuracy: 0.6040
Precision: 0.6040
Recall: 0.6040
F1-score: 0.6040
Evaluating DQL model for hormone_therapy
Evaluation metrics for hormone_therapy:
Accuracy: 0.6090
Precision: 0.6090
Recall: 0.6090
F1-score: 0.6090
Evaluating DQL model for radiotherapy
Evaluation metrics for radiotherapy:
Accuracy: 0.5990
Precision: 0.5990
Recall: 0.5990
F1-score: 0.5990
DQL model evaluation completed.

Treatment Simulator Evaluation Results:
Outcome: OS
Mean Accuracy: 0.4154
95% Confidence Interval: [0.3945, 0.4380]
Outcome: DFS
Mean Accuracy: 0.3659
95% Confidence Interval: [0.3455, 0.3875]
Outcome: RFS
Mean Accuracy: 0.4118
95% Confidence Interval: [0.3885, 0.4330]

DQL Model Evaluation Results:
Decision: surgery
Accuracy: 0.6060
Precision: 0.6060
Recall: 0.6060
F1-score: 0.6060
Decision: chemotherapy
Accuracy: 0.6040
Precision: 0.6040
Recall: 0.6040
F1-score: 0.6040
Decision: hormone_therapy
Accuracy: 0.6090
Precision: 0.6090
Recall: 0.6090
F1-score: 0.6090
Decision: radiotherapy
Accuracy: 0.5990
Precision: 0.5990
Recall: 0.5990
F1-score: 0.5990




with recursive training


Selected features for each outcome variable:
OS: ['age', 'biopsy_preTreat', 'tumor_size_cm_preTrt_preSurgery', 'nuclear_grade_preTrt', 'ERbb2_preTrt', 'Erbeta_preTrt', 'carboplatin', 'Race', 'RCB', 'menopausal_status']
DFS: ['chemotherapy', 'hormone_therapy', 'pCR_postTrt_days', 'topoihc_preTrt', 'metastasis_months', 'died_from_cancer_if_dead', 'ERBB2_CPN_amplified', 'tumor_size_cm_postTrt_1', 'pCR_spectrum', 'estrogen_receptor']
RFS: ['hormone_therapy', 'pCR_postTrt_days', 'metastasis_months', 'tumor_size_cm_postTrt', 'ESR1_preTrt', 'cytokeratin5_pos', 'epirubicin', 'tumor_stage_postTrt', 'pCR_spectrum', 'therapy']
Error: An unexpected error occurred during training: cannot access local variable 'prev_outputs' where it is not associated with a value
Feature importance for surgery:
[('preTrt_totalLymphNodes', 0.55), ('PR_percentage_preTrt', 0.45)]
Feature importance for chemotherapy:
[('postTrt_numPosLymphNodes', 0.5), ('topoihc_preTrt', 0.5)]
Feature importance for hormone_therapy:
[('pCR_postTrt_days', 0.56), ('metastasis_months', 0.44)]
Feature importance for radiotherapy:
[('metastasis_months_2', 0.24), ('preTrt_numPosLymphNodes', 0.23), ('PR_fmolmg_preTrt', 0.2), ('ER_fmolmg_preTrt', 0.19), ('age', 0.14)]
Building and evaluating Treatment Simulator model for OS.
Loaded trained Treatment Simulator model for OS
Best hyperparameters for OS:
{'C': 0.1, 'class_weight': 'balanced', 'degree': 2, 'gamma': 'scale', 'kernel': 'poly'}
Evaluating Treatment Simulator model for OS
Outcome: OS
Mean Accuracy: 0.4155
95% Confidence Interval: [0.3935, 0.4380]
Treatment Simulator evaluation completed for OS.
Building and evaluating Treatment Simulator model for DFS.
Loaded trained Treatment Simulator model for DFS

Best hyperparameters for DFS:
{'C': 0.1, 'class_weight': 'balanced', 'degree': 2, 'gamma': 'scale', 'kernel': 'poly'}
Evaluating Treatment Simulator model for DFS
Outcome: DFS
Mean Accuracy: 0.3658
95% Confidence Interval: [0.3455, 0.3880]
Treatment Simulator evaluation completed for DFS.
Building and evaluating Treatment Simulator model for RFS.
Loaded trained Treatment Simulator model for RFS

Best hyperparameters for RFS:
{'C': 0.1, 'class_weight': 'balanced', 'degree': 2, 'gamma': 'scale', 'kernel': 'poly'}
Evaluating Treatment Simulator model for RFS
Outcome: RFS
Mean Accuracy: 0.4113
95% Confidence Interval: [0.3895, 0.4320]
Treatment Simulator evaluation completed for RFS.
Evaluating DQL model for surgery
Evaluation metrics for surgery:
Accuracy: 0.6060
Precision: 0.6060
Recall: 0.6060
F1-score: 0.6060
Evaluating DQL model for chemotherapy
Evaluation metrics for chemotherapy:
Accuracy: 0.5830
Precision: 0.5830
Recall: 0.5830
F1-score: 0.5830
Evaluating DQL model for hormone_therapy
Evaluation metrics for hormone_therapy:
Accuracy: 0.6090
Precision: 0.6090
Recall: 0.6090
F1-score: 0.6090
Evaluating DQL model for radiotherapy
Evaluation metrics for radiotherapy:
Accuracy: 0.5990
Precision: 0.5990
Recall: 0.5990
F1-score: 0.5990
DQL model evaluation completed.

Treatment Simulator Evaluation Results:
Outcome: OS
Mean Accuracy: 0.4155
95% Confidence Interval: [0.3935, 0.4380]
Outcome: DFS
Mean Accuracy: 0.3658
95% Confidence Interval: [0.3455, 0.3880]
Outcome: RFS
Mean Accuracy: 0.4113
95% Confidence Interval: [0.3895, 0.4320]

DQL Model Evaluation Results:
Decision: surgery
Accuracy: 0.6060
Precision: 0.6060
Recall: 0.6060
F1-score: 0.6060
Decision: chemotherapy
Accuracy: 0.5830
Precision: 0.5830
Recall: 0.5830
F1-score: 0.5830
Decision: hormone_therapy
Accuracy: 0.6090
Precision: 0.6090
Recall: 0.6090
F1-score: 0.6090
Decision: radiotherapy
Accuracy: 0.5990
Precision: 0.5990
Recall: 0.5990
F1-score: 0.5990



the final code results with recent generated dataset with Ki67 features:

Data preprocessing completed.
Feature selection completed.
Selected features for each outcome variable:
OS: ['tumor_size', 'lymph_nodes', 'hormone_receptor_status', 'her2_status', 'grade', 'stage', 'Ki67_expression', 'surgery', 'chemotherapy', 'radiotherapy']
DFS: ['age', 'tumor_size', 'hormone_receptor_status', 'her2_status', 'grade', 'stage', 'oncotype_score', 'surgery', 'chemotherapy', 'hormone_therapy']
RFS: ['tumor_size', 'lymph_nodes', 'her2_status', 'grade', 'stage', 'histology', 'Ki67_expression', 'oncotype_score', 'surgery', 'radiotherapy']

Feature importance for surgery:
[('Ki67_expression', 0.18930267404270495), ('oncotype_score', 0.18792109500392284), ('tumor_size', 0.1751141708290647), ('age', 0.1347501340334163), ('lymph_nodes', 0.0690389136754167), ('stage', 0.04152140901061025), ('grade', 0.033103572914663794), ('histology', 0.03171528912868865), ('chemotherapy', 0.01967471305999913), ('hormone_therapy', 0.018172286354321526), ('her2_status', 0.018012780817887722), ('RFS', 0.017422914159287796), ('hormone_receptor_status', 0.016962766102255736), ('radiotherapy', 0.01651710364587524), ('OS', 0.015413099976952522), ('DFS', 0.015357077244932347)]
Feature importance for chemotherapy:
[('Ki67_expression', 0.1833579877543149), ('oncotype_score', 0.1819028672935803), ('tumor_size', 0.18127265467552992), ('age', 0.1350023632179741), ('lymph_nodes', 0.06435880266586595), ('stage', 0.03972478567758261), ('grade', 0.03463269011024328), ('histology', 0.03091025806110193), ('surgery', 0.020912879831503535), ('RFS', 0.02037024613461829), ('hormone_therapy', 0.019216694538888437), ('DFS', 0.018233836049848545), ('hormone_receptor_status', 0.01821998473354336), ('her2_status', 0.01755587794972347), ('radiotherapy', 0.0174943814401183), ('OS', 0.0168336898655631)]
Feature importance for hormone_therapy:
[('oncotype_score', 0.19477842283348848), ('tumor_size', 0.18178504108194224), ('Ki67_expression', 0.17593218863979487), ('age', 0.12725109225018047), ('lymph_nodes', 0.06433427786902604), ('stage', 0.0441967911794037), ('grade', 0.03583876579435174), ('histology', 0.03251936255988603), ('surgery', 0.020848924744187904), ('chemotherapy', 0.020668304386068655), ('her2_status', 0.019149782340312584), ('hormone_receptor_status', 0.018621691269937325), ('RFS', 0.01753331406105366), ('radiotherapy', 0.017090450733062864), ('DFS', 0.015382993623209612), ('OS', 0.014068596634093941)]
Feature importance for radiotherapy:
[('oncotype_score', 0.19268062722154466), ('tumor_size', 0.18807606994835005), ('Ki67_expression', 0.18781327294827166), ('age', 0.13286740857705473), ('lymph_nodes', 0.06803434774125834), ('stage', 0.040039231228745045), ('histology', 0.029917856069386385), ('grade', 0.02839103657780616), ('DFS', 0.01832281749317619), ('chemotherapy', 0.017379808327693348), ('hormone_receptor_status', 0.017195135635923786), ('her2_status', 0.016693643650854257), ('RFS', 0.01667177099894898), ('surgery', 0.01623350500910182), ('hormone_therapy', 0.01590911443253242), ('OS', 0.013774354139352364)]
Building and evaluating Treatment Simulator model for OS.
Loaded trained Treatment Simulator model for OS
Fitting 5 folds for each of 144 candidates, totalling 720 fits
Best hyperparameters for DFS:
{'C': 0.1, 'class_weight': None, 'degree': 2, 'gamma': 'scale', 'kernel': 'linear'}
Evaluating Treatment Simulator model for DFS
Best hyperparameters for RFS:
{'C': 0.1, 'class_weight': 'balanced', 'degree': 2, 'gamma': 'auto', 'kernel': 'sigmoid'}
Evaluating Treatment Simulator model for RFS


Best hyperparameters for RFS:
{'C': 0.1, 'class_weight': 'balanced', 'degree': 2, 'gamma': 'auto', 'kernel': 'sigmoid'}
Evaluating Treatment Simulator model for RFS
Outcome: RFS
Mean Accuracy: 0.6695
95% Confidence Interval: [0.6485, 0.6905]
Treatment Simulator evaluation completed for RFS.
Error: Error(s) in loading state_dict for TreatmentModel:
        size mismatch for hidden_layers.0.weight: copying a param with shape torch.Size([512, 84]) from checkpoint, the shape in current model is torch.Size([512, 16]).
Possible reasons:
1. Mismatch between the input data and the model's input size.
2. Insufficient memory to allocate tensors.
DQL model evaluation failed.

Treatment Simulator Evaluation Results:
Outcome: OS
Mean Accuracy: 0.8229
95% Confidence Interval: [0.8060, 0.8395]
Outcome: DFS
Mean Accuracy: 0.7122
95% Confidence Interval: [0.6930, 0.7320]
Outcome: RFS
Mean Accuracy: 0.6695
95% Confidence Interval: [0.6485, 0.6905]
DQL Model Evaluation failed.